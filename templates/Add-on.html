<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FinNest - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f8fafc;
      font-family: 'Segoe UI', sans-serif;
    }
    h2.title { font-weight: 700; color: #005f73; }
    .card, .table-container {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .table thead, .table-light { background-color: #e9f3ff; }
    .table td, .table th { vertical-align: middle; }
    .progress { height: 18px; border-radius: 30px; }
    .progress-bar { font-size: 0.8rem; font-weight: 600; }
    .countdown { font-weight: 600; color: #0d6efd; }
    .btn-success { background-color: #0a9396; border: none; }
    .btn-success:hover { background-color: #007f7b; }
  </style>
</head>
<body>
  <div class="container py-5">
    <h2 class="text-center mb-5 title">ðŸ“Š FinNest Dashboard</h2>

    <!-- SAVINGS GOAL TRACKER -->
    <section class="mb-5">
      <h4 class="mb-3">ðŸŽ¯ Savings Goal Tracker</h4>
      <div class="card mb-4 p-4">
        <form id="goalForm" class="row g-3">
          <div class="col-md-4">
            <input type="text" class="form-control" id="goalName" placeholder="Goal Name (e.g., Bike)" required />
          </div>
          <div class="col-md-3">
            <input type="number" class="form-control" id="targetAmount" placeholder="Target Amount (â‚¹)" required />
          </div>
          <div class="col-md-3">
            <input type="number" class="form-control" id="savedAmount" placeholder="Amount Saved (â‚¹)" required />
          </div>
          <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-success">Add Goal</button>
          </div>
        </form>
      </div>

      <div class="table-container table-responsive p-3">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th>Goal</th>
              <th>Saved / Target</th>
              <th>Progress</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="goalTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- SUBSCRIPTION MANAGER -->
    <section class="mb-5">
      <h4 class="mb-3">ðŸ“… Subscription Manager</h4>
      <div class="card mb-4 p-4">
        <form id="subscriptionForm" class="row g-3">
          <div class="col-md-4">
            <input type="text" class="form-control" id="subName" placeholder="Subscription Name" required />
          </div>
          <div class="col-md-3">
            <input type="number" class="form-control" id="subAmount" placeholder="Amount (â‚¹)" required />
          </div>
          <div class="col-md-3">
            <input type="date" class="form-control" id="subRenewal" required />
          </div>
          <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-success">Add Subscription</button>
          </div>
        </form>
      </div>

      <div class="table-container table-responsive p-3">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Amount</th>
              <th>Next Renewal</th>
              <th>Days Left</th>
              <th>Reminder</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="subscriptionsTableBody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Goal Update Modal -->
  <div class="modal fade" id="goalModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Update Goal</h5></div>
        <div class="modal-body">
          <input type="number" id="modalSavedAmount" class="form-control" placeholder="New Saved Amount (â‚¹)" />
          <input type="hidden" id="modalGoalId" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveGoalUpdate()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Subscription Update Modal -->
  <div class="modal fade" id="subModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Update Subscription</h5></div>
        <div class="modal-body">
          <input type="number" id="modalSubAmount" class="form-control mb-2" placeholder="New Amount (â‚¹)" />
          <input type="date" id="modalSubRenewal" class="form-control mb-2" />
          <input type="hidden" id="modalSubIndex" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveSubUpdate()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap + Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ================== SAVINGS GOALS ================== //
    let goals = JSON.parse(localStorage.getItem("goals")) || [];

    document.getElementById("goalForm").addEventListener("submit", function (e) {
      e.preventDefault();
      let goalName = document.getElementById("goalName").value;
      let targetAmount = parseFloat(document.getElementById("targetAmount").value);
      let savedAmount = parseFloat(document.getElementById("savedAmount").value);
      let goal = { id: Date.now(), goalName, targetAmount, savedAmount };
      goals.push(goal);
      saveGoals(); renderGoals(); this.reset();
    });

    function saveGoals() { localStorage.setItem("goals", JSON.stringify(goals)); }

    function renderGoals() {
      let tableBody = document.getElementById("goalTableBody");
      tableBody.innerHTML = "";
      goals.forEach(goal => {
        let progressPercent = Math.min((goal.savedAmount / goal.targetAmount) * 100, 100).toFixed(1);
        let status = goal.savedAmount >= goal.targetAmount ? "âœ… Achieved" : "â³ In Progress";
        let progressColor = progressPercent >= 100 ? "bg-success" : progressPercent >= 50 ? "bg-warning" : "bg-danger";

        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${goal.goalName}</td>
          <td>â‚¹${goal.savedAmount.toLocaleString()} / â‚¹${goal.targetAmount.toLocaleString()}</td>
          <td><div class="progress"><div class="progress-bar ${progressColor}" style="width:${progressPercent}%">${progressPercent}%</div></div></td>
          <td><strong>${status}</strong></td>
          <td>
            <button class="btn btn-sm btn-primary me-2" onclick="openGoalModal(${goal.id}, ${goal.savedAmount})">Update</button>
            <button class="btn btn-sm btn-danger" onclick="deleteGoal(${goal.id})">Delete</button>
          </td>`;
        tableBody.appendChild(row);
      });
    }

    function openGoalModal(id, savedAmount) {
      document.getElementById("modalGoalId").value = id;
      document.getElementById("modalSavedAmount").value = savedAmount;
      new bootstrap.Modal(document.getElementById("goalModal")).show();
    }

    function saveGoalUpdate() {
      let id = parseInt(document.getElementById("modalGoalId").value);
      let newAmount = parseFloat(document.getElementById("modalSavedAmount").value);
      let goal = goals.find(g => g.id === id);
      if (goal && !isNaN(newAmount)) {
        goal.savedAmount = newAmount; saveGoals(); renderGoals();
        bootstrap.Modal.getInstance(document.getElementById("goalModal")).hide();
        showToast("Goal updated successfully!");
      }
    }

    function deleteGoal(id) {
      if (confirm("Delete this goal?")) {
        goals = goals.filter(g => g.id !== id); saveGoals(); renderGoals();
        showToast("Goal deleted.");
      }
    }

    // ================== SUBSCRIPTIONS ================== //
    let subscriptions = JSON.parse(localStorage.getItem("subscriptions")) || [
      { name: "Netflix", amount: 499, currency: "â‚¹", nextRenewal: "2025-08-10", remind: true }
    ];

    function saveSubscriptions() { localStorage.setItem("subscriptions", JSON.stringify(subscriptions)); }

    function daysUntil(dateStr) {
      const today = new Date(); const date = new Date(dateStr);
      const diffTime = date - today; return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }

    function renderTable() {
      const tbody = document.getElementById("subscriptionsTableBody"); tbody.innerHTML = "";
      subscriptions.forEach((sub, idx) => {
        const daysLeft = daysUntil(sub.nextRenewal);
        let statusColor = daysLeft < 0 ? "text-danger" : "countdown";
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${sub.name}</td>
          <td><strong>${sub.currency}${sub.amount}</strong></td>
          <td>${sub.nextRenewal}</td>
          <td><span class="${statusColor}">${daysLeft >= 0 ? daysLeft : "Overdue"} day${daysLeft === 1 ? "" : "s"}</span></td>
          <td><input type="checkbox" class="form-check-input" ${sub.remind ? 'checked' : ''} onchange="toggleReminder(${idx}, this.checked)" /></td>
          <td>
            <button class="btn btn-sm btn-primary me-2" onclick="openSubModal(${idx})">Update</button>
            <button class="btn btn-sm btn-danger" onclick="deleteSubscription(${idx})">Delete</button>
          </td>`;
        tbody.appendChild(row);
      });
    }

    document.getElementById("subscriptionForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("subName").value.trim();
      const amount = parseFloat(document.getElementById("subAmount").value);
      const renewal = document.getElementById("subRenewal").value;
      if (!name || !amount || !renewal) { showToast("âš  Fill all fields"); return; }
      subscriptions.push({ name, amount, currency: "â‚¹", nextRenewal: renewal, remind: true });
      saveSubscriptions(); renderTable(); this.reset();
      showToast(`${name} added.`);
    });

    function openSubModal(idx) {
      document.getElementById("modalSubIndex").value = idx;
      document.getElementById("modalSubAmount").value = subscriptions[idx].amount;
      document.getElementById("modalSubRenewal").value = subscriptions[idx].nextRenewal;
      new bootstrap.Modal(document.getElementById("subModal")).show();
    }

    function saveSubUpdate() {
      let idx = parseInt(document.getElementById("modalSubIndex").value);
      let newAmount = parseFloat(document.getElementById("modalSubAmount").value);
      let newRenewal = document.getElementById("modalSubRenewal").value;
      if (!isNaN(newAmount) && newRenewal) {
        subscriptions[idx].amount = newAmount;
        subscriptions[idx].nextRenewal = newRenewal;
        saveSubscriptions(); renderTable();
        bootstrap.Modal.getInstance(document.getElementById("subModal")).hide();
        showToast("Subscription updated!");
      }
    }

    function toggleReminder(idx, checked) {
      subscriptions[idx].remind = checked; saveSubscriptions();
      showToast(`${subscriptions[idx].name} reminder ${checked ? "ON" : "OFF"}`);
    }

    function deleteSubscription(idx) {
      if (confirm("Delete subscription?")) {
        subscriptions.splice(idx, 1); saveSubscriptions(); renderTable();
        showToast("Subscription deleted.");
      }
    }

    // ================== TOAST ================== //
    function showToast(message) {
      let toast = document.createElement("div");
      toast.className = "toast align-items-center text-bg-primary border-0 show position-fixed bottom-0 end-0 m-3";
      toast.innerHTML = `<div class="d-flex"><div class="toast-body">${message}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Initial render
    renderGoals(); renderTable();
  </script>
</body>
</html>
